# Reference: https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/what-is-sam.html
# Resources Generated By SAM: https://github.com/aws/serverless-application-model/blob/master/docs/internals/generated_resources.rst

AWSTemplateFormatVersion: 2010-09-09
Transform: AWS::Serverless-2016-10-31
Description: Digital Identity IPV CRI Address API

Parameters:
  Environment:
    Description: environment name
    Default: dev
    Type: String
    AllowedValues:
      - dev
      - staging
      - integration
      - prod
    ConstraintDescription: specify dev, staging, integration or prod for environment

Globals:
  Function:
    Timeout: 60 # seconds
    Runtime: java11
    AutoPublishAlias: live
    MemorySize: 512

Resources:

  AddressApi: # see https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-api.html
    Type: AWS::Serverless::Api
    Properties:
      StageName: !Ref Environment
      DefinitionUri: ./api.yaml

  SessionFunction: # see https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/sam-resource-function.html
    Type: AWS::Serverless::Function
    Properties:
      CodeUri: build/distributions/di-ipv-cri-address-api.zip
      Handler: uk.gov.di.ipv.cri.address.api.handler.SessionHandler
      Events:
        GetQuestionsFunctionApi:
          Type: Api
          Properties:
            RestApiId: !Ref AddressApi
            Path: /session
            Method: post
